# 1、新建插件项目

> File > New Project... > Library > Qt Creator Plugin

![[Pasted image 20240822150547.png]]![[Pasted image 20240822150649.png]]

> ***Qt Creator build中选择QtCreator的编译路径***

> 在`CMakeLists.txt`中添加
``` cmake
set(QTCREATOR_PLUGINS_PATH "<QtCreator编译路径中的/plugins>")

set_target_properties(MyPlugin PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${QTCREATOR_PLUGINS_PATH}"
    LIBRARY_OUTPUT_DIRECTORY "${QTCREATOR_PLUGINS_PATH}"
)

```
# 2、开发插件

***功能现实写在initialize()中***
## 1、菜单栏

``` C++
// 1. 获取菜单栏对象
ActionContainer *menubar = ActionManager::actionContainer(Constants::MENU_BAR);

// 2.添加菜单组
menubar->appendGroup("QtCreator.Group.Id");
// QtCreator.Group.Id 为该组的Id

// 3.创建菜单
ActionContainer *menu = ActionManager::createMenu("QtCreator.Menu.Id");
// QtCreator.Menu.Id 为该菜单注册的Id

// 4.将菜单添加到菜单栏
menubar->addMenu(menu, "QtCreator.Group.Id");
// 第一个参数为添加的菜单对象;第二个为需要添加到的组

// 5.给菜单添加组
 menu->appendGroup("QtCreator.Group.Id.G1");
 menu->appendGroup("QtCreator.Group.Id.G2");

// 6.给菜单添加Action(方法一)
// 获取菜单对象
ActionContainer *menu = ActionManager::actionContainer("QtCreator.Menu.Id");
// 以组添加分隔线
menu->addSeparator("QtCreator.Group.Id.G1");
// 创建Action对象,Id为QtCreator.newAction
ActionBuilder newAction(this, "QtCreator.newAction");
// 添加到菜单，第一个参数为菜单Id，第二个参数为添加到的组Id
newAction.addToContainer("QtCreator.Menu.Id", "QtCreator.Group.Id.G1");

// 6.给菜单添加Action(方法二)
QAction action = new QAction(Tr::tr("Action"), this);
// ACTION_ID为Id
Core::Command *cmd = Core::ActionManager::registerAction(action,ACTION_ID,Core::Context(Core::Constants::C_GLOBAL));
// 设置快捷键
cmd->setDefaultKeySequence(QKeySequence(Tr::tr("Ctrl+Alt+A")));
// Core::Constants::M_TOOLS为工具栏的Id
Core::ActionManager::actionContainer(Core::Constants::M_TOOLS)->addAction(cmd);

```
## 2、侧边栏及页面切换
``` C++
// 1.创建DemoMode类，该类需要继承IMode
class DemoMode : public IMode
{
public:
    DemoMode();
};

// 2.在DemoMode的构造函数实现中
DemoMode::DemoMode()
{
	// 创建一个QWidget对象
	QWidget *widget = new QWidget();
	// 设置QWidget对象为部件
	setWidget(widget);
	// 设置上下文
	setContext(Core::Context("Demo.MainView"));
	// 设置IMode显示名称,同时也是侧边栏的名称
	setDisplayName("插件示例");
	// 设置图标
	// setIcon();
	// 设置优先
    setPriority(0);
    // 设置Id
    setId("Demo.DemoMode");
    // 设置上下文
    // setContext(Context("Demo.DemoMode", Constants::C_NAVIGATION_PANE));
}
```